"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function isPowerOfTwo(e){for(;e%2==0&&e>1;)e/=2;return 1==e}function error(e){throw new Error("Meyda: "+e)}function hanning(e){for(var t=new Float32Array(e),r=0;e>r;r++)t[r]=.5-.5*Math.cos(2*Math.PI*r/(e-1));return t}function hamming(e){for(var t=new Float32Array(e),r=0;e>r;r++)t[r]=.54-.46*Math.cos(2*Math.PI*(r/e-1));return t}function mu(e,t){for(var r=0,a=0,o=0;o<t.length;o++)r+=Math.pow(o,e)*Math.abs(t[o]),a+=t[o];return r/a}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var _extractorsRms=require("extractors/rms"),_extractorsRms2=_interopRequireDefault(_extractorsRms),_extractorsEnergy=require("extractors/energy"),_extractorsEnergy2=_interopRequireDefault(_extractorsEnergy),_extractorsSpectralSlope=require("extractors/spectralSlope"),_extractorsSpectralSlope2=_interopRequireDefault(_extractorsSpectralSlope),_extractorsSpectralCentroid=require("extractors/spectralCentroid"),_extractorsSpectralCentroid2=_interopRequireDefault(_extractorsSpectralCentroid),_extractorsSpectralRolloff=require("extractors/spectralRolloff"),_extractorsSpectralRolloff2=_interopRequireDefault(_extractorsSpectralRolloff),_extractorsSpectralFlatness=require("extractors/spectralFlatness"),_extractorsSpectralFlatness2=_interopRequireDefault(_extractorsSpectralFlatness),_extractorsSpectralSpread=require("extractors/spectralSpread"),_extractorsSpectralSpread2=_interopRequireDefault(_extractorsSpectralSpread),_extractorsSpectralSkewness=require("extractors/spectralSkewness"),_extractorsSpectralSkewness2=_interopRequireDefault(_extractorsSpectralSkewness),_extractorsSpectralKurtosis=require("extractors/spectralKurtosis"),_extractorsSpectralKurtosis2=_interopRequireDefault(_extractorsSpectralKurtosis),_extractorsZcr=require("extractors/zcr"),_extractorsZcr2=_interopRequireDefault(_extractorsZcr),_extractorsLoudness=require("extractors/loudness"),_extractorsLoudness2=_interopRequireDefault(_extractorsLoudness),_extractorsPerceptualSpread=require("extractors/perceptualSpread"),_extractorsPerceptualSpread2=_interopRequireDefault(_extractorsPerceptualSpread),_extractorsPerceptualSharpness=require("extractors/perceptualSharpness"),_extractorsPerceptualSharpness2=_interopRequireDefault(_extractorsPerceptualSharpness),_extractorsMfcc=require("extractors/mfcc"),_extractorsMfcc2=_interopRequireDefault(_extractorsMfcc);exports["default"]={buffer:function(e,t){return t.signal},rms:_extractorsRms2["default"],energy:_extractorsEnergy2["default"],complexSpectrum:function(e,t){return t.complexSpectrum},spectralSlope:_extractorsSpectralSlope2["default"],spectralCentroid:_extractorsSpectralCentroid2["default"],spectralRolloff:_extractorsSpectralRolloff2["default"],spectralFlatness:_extractorsSpectralFlatness2["default"],spectralSpread:_extractorsSpectralSpread2["default"],spectralSkewness:_extractorsSpectralSkewness2["default"],spectralKurtosis:_extractorsSpectralKurtosis2["default"],amplitudeSpectrum:function(e,t){return t.ampSpectrum},zcr:_extractorsZcr2["default"],loudness:_extractorsLoudness2["default"],perceptualSpread:_extractorsPerceptualSpread2["default"],perceptualSharpness:_extractorsPerceptualSharpness2["default"],mfcc:_extractorsMfcc2["default"]},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_util=require("util"),utilities=_interopRequireWildcard(_util),_featureExtractors=require("featureExtractors"),_featureExtractors2=_interopRequireDefault(_featureExtractors),_default=function(){var e=function(t,r,a,o){_classCallCheck(this,e),isPowerOfTwo(s)||t||utilities.error("Invalid Constructor Arguments");var l,s=a||256,u=!1;this.windowingFunction="hanning",self.setSource=function(e){source=e,source.connect(window.spn)},window.spn=t.createScriptProcessor(s,1,1),spn.connect(t.destination),window.spn.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);self.signal=t;var r=self.windowing(self.signal,self.windowingFunction),a=new complex_array.ComplexArray(s);a.map(function(e,t,a){e.real=r[t]});var n=a.FFT();self.complexSpectrum=n,self.ampSpectrum=new Float32Array(s/2);for(var c=0;s/2>c;c++)self.ampSpectrum[c]=Math.sqrt(Math.pow(n.real[c],2)+Math.pow(n.imag[c],2));"function"==typeof o&&u&&o(self.get(l))},self.start=function(e){l=e,u=!0},self.stop=function(){u=!1},self.audioContext=t,source.connect(window.spn,0,0)};return _createClass(e,[{key:"get",value:function(e){if("object"==typeof e){for(var t={},r=0;r<e.length;r++)try{t[e[r]]=self.featureExtractors[e[r]](bufferSize,self)}catch(a){console.error(a)}return t}if("string"==typeof e)return self.featureExtractors[e](bufferSize,self);throw"Invalid Feature Format"}}]),e}();exports["default"]=_default,module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports.isPowerOfTwo=isPowerOfTwo,exports.error=error,Object.defineProperty(exports,"__esModule",{value:!0}),exports.hanning=hanning,exports.hamming=hamming;var generateBlackman=function(e){for(var t=new Float32Array(e),r=0;e%2>r?(e+1)/2:e/2;r++)t[r]=.42-.5*Math.cos(2*Math.PI*r/(e-1))+.08*Math.cos(4*Math.PI*r/(e-1));for(var r=e/2;r>0;r--)t[e-r]=t[r]};Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=0,a=0;a<t.signal.length;a++)r+=Math.pow(Math.abs(t.signal[a]),2);return r},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports.mu=mu,Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=new Float32Array(t.ampSpectrum.length),a=24,o=new Float32Array(a),l=0,s=t.ampSpectrum,u=new Int32Array(a+1),n=0;n<r.length;n++)r[n]=n*t.audioContext.sampleRate/e,r[n]=13*Math.atan(r[n]/1315.8)+3.5*Math.atan(Math.pow(r[n]/7518,2));u[0]=0;for(var c=r[t.ampSpectrum.length-1]/a,i=1,n=0;n<t.ampSpectrum.length;n++)for(;r[n]>c;)u[i++]=n,c=i*r[t.ampSpectrum.length-1]/a;u[a]=t.ampSpectrum.length-1;for(var n=0;a>n;n++){for(var p=0,f=u[n];f<u[n+1];f++)p+=s[f];o[n]=Math.pow(p,.23)}for(var n=0;n<o.length;n++)l+=o[n];return{specific:o,total:l}},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0});var melToFreq=function(e){var t=700*(Math.exp(e/1125)-1);return t},freqToMel=function(e){var t=1125*Math.log(1+e/700);return t};exports["default"]=function(e,t){for(var r=t.featureExtractors.powerSpectrum(e,t),a=26,o=new Float32Array(a+2),l=new Float32Array(a+2),s=0,u=audioContext.sampleRate/2,n=freqToMel(s),c=freqToMel(u),i=c-n,p=i/(a+1),f=Array(a+2),x=0;x<o.length;x++)o[x]=x*p,l[x]=melToFreq(o[x]),f[x]=Math.floor((e+1)*l[x]/audioContext.sampleRate);for(var d=Array(a),_=0;_<d.length;_++){d[_]=Array.apply(null,new Array(e/2+1)).map(Number.prototype.valueOf,0);for(var x=f[_];x<f[_+1];x++)d[_][x]=(x-f[_])/(f[_+1]-f[_]);for(var x=f[_+1];x<f[_+2];x++)d[_][x]=(f[_+2]-x)/(f[_+2]-f[_+1])}for(var m=new Float32Array(a),x=0;x<m.length;x++){m[x]=0;for(var _=0;e/2>_;_++)d[x][_]=d[x][_]*r[_],m[x]+=d[x][_];m[x]=Math.log(m[x])}for(var h=Math.PI/a,S=1/Math.sqrt(a),v=Math.sqrt(2/a),M=13,g=new Float32Array(M*a),x=0;M>x;x++)for(var _=0;a>_;_++){var w=x+_*M;g[w]=0==x?S*Math.cos(h*(x+1)*(_+.5)):v*Math.cos(h*(x+1)*(_+.5))}for(var y=new Float32Array(M),h=0;M>h;h++){for(var q=0,R=0;a>R;R++){var w=h+R*M;q+=g[w]*m[R]}y[h]=q/M}return y},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=t.featureExtractors.loudness(e,t),a=r.specific,o=0,l=0;l<a.length;l++)o+=15>l?(l+1)*a[l+1]:.066*Math.exp(.171*(l+1));return o*=.11/r.total},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=t.featureExtractors.loudness(e,t),a=0,o=0;o<r.specific.length;o++)r.specific[o]>a&&(a=r.specific[o]);var l=Math.pow((r.total-a)/r.total,2);return l},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=new Float32Array(t.ampSpectrum.length),a=0;a<r.length;a++)r[a]=Math.pow(t.ampSpectrum[a],2);return r},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=0,a=0;a<t.signal.length;a++)r+=Math.pow(t.signal[a],2);return r/=t.signal.length,r=Math.sqrt(r)},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0});var _extractorUtilities=require("extractorUtilities"),_extractorUtilities2=_interopRequireDefault(_extractorUtilities);exports["default"]=function(e,t){return _extractorUtilities2["default"](1,t.ampSpectrum)},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=t.ampSpectrum,a=0,o=0,l=0;l<r.length;l++)a+=Math.log(r[l]),o+=r[l];return Math.exp(a/r.length)*r.length/o},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0});var _extractorUtilities=require("extractorUtilities"),_extractorUtilities2=_interopRequireDefault(_extractorUtilities);exports["default"]=function(e,t){var r=t.ampSpectrum,a=_extractorUtilities2["default"](1,r),o=_extractorUtilities2["default"](2,r),l=_extractorUtilities2["default"](3,r),s=_extractorUtilities2["default"](4,r),u=-3*Math.pow(a,4)+6*a*o-4*a*l+s,n=Math.pow(Math.sqrt(o-Math.pow(a,2)),4);return u/n},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=t.ampSpectrum,a=t.audioContext.sampleRate/(2*(r.length-1)),o=0,l=0;l<r.length;l++)o+=r[l];for(var s=.99*o,u=r.length-1;o>s&&u>=0;)o-=r[u],--u;return(u+1)*a},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0});var _extractorUtilities=require("extractorUtilities"),_extractorUtilities2=_interopRequireDefault(_extractorUtilities);exports["default"]=function(e,t,r){var a=t.ampSpectrum,o=_extractorUtilities2["default"](1,a),l=_extractorUtilities2["default"](2,a),s=_extractorUtilities2["default"](3,a),u=2*Math.pow(o,3)-3*o*l+s,n=Math.pow(Math.sqrt(l-Math.pow(o,2)),3);return u/n},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=0,a=0,o=new Float32Array(t.ampSpectrum.length),l=0,s=0,u=0;u<t.ampSpectrum.length;u++){r+=t.ampSpectrum[u];var n=u*t.audioContext.sampleRate/e;o[u]=n,l+=n*n,a+=n,s+=n*t.ampSpectrum[u]}return(t.ampSpectrum.length*s-a*r)/(r*(l-Math.pow(a,2)))},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0});var _extractorUtilities=require("extractorUtilities"),_extractorUtilities2=_interopRequireDefault(_extractorUtilities);exports["default"]=function(e,t){var r=t.ampSpectrum;return Math.sqrt(_extractorUtilities2["default"](2,r)-Math.pow(_extractorUtilities2["default"](1,r),2))},module.exports=exports["default"],Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(e,t){for(var r=0,a=0;a<t.signal.length;a++)(t.signal[a]>=0&&t.signal[a+1]<0||t.signal[a]<0&&t.signal[a+1]>=0)&&r++;return r},module.exports=exports["default"];
//# sourceMappingURL=meyda.js.map