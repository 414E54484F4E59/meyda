<!DOCTYPE html>
<html>
<head>
	<title>Meyda</title>
	<script type="text/javascript" src="main.js"></script>
	<meta charset="UTF-8">
</head>
<body>
	<h1>Meyda</h1>
	<p>Meyda is a feature extractor for the web audio API</p>
	<div id="feedback"></div>
	<script id="template" type="text/ractive">
	<p>RMS: {{rms}}</p>
	</script>
	<script src='http://cdn.ractivejs.org/latest/ractive.js'></script>
	<script>
		// using ractive to display things
		var ractive = new Ractive({
			el: 'feedback',
			template: '#template',
			data: {}
		});

		// callback for mic position
		function gotStream(stream) {
			// polyfill
			window.AudioContext = window.AudioContext || window.webkitAudioContext;
			var context = new AudioContext();

			// instantiate new medya
			var m = new Medya(context,function(d){
				// update view in callback
				ractive.set({rms:d});
			});

			// create audionode from mic
			window.source = context.createMediaStreamSource( stream );

			// connect mic to medya
			source.connect( m );
		}
		// Polyfill for browser prefixes
		navigator.getUserMedia = navigator.getUserMedia || (navigator.mozGetUserMedia || navigator.webkitGetUserMedia);
		// Ask for mic permission
		navigator.getUserMedia( {audio:true}, gotStream, function(){
			console.log("error: getUserMedia Failed");
		});
	</script>
</body>
</html>