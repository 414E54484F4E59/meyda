/*! Meyda 28-01-2015 */
var Meyda=function(a,b,c,d){var e,f=this,g=c?c:256,h=b,i=!1,j=function(a,b){for(var c=0,d=0,e=0;e<b.length;e++)c+=Math.pow(e,a)*Math.abs(b[e]),d+=b[e];return c/d},k=function(a){for(;a%2==0&&a>1;)a/=2;return 1==a};f.barkScale=new Float32Array(c);for(var l=0;l<barkScale.length;l++)f.barkScale[l]=l*a.sampleRate/c,f.barkScale[l]=13*Math.atan(f.barkScale[l]/1315.8)+3.5*Math.atan(Math.pow(f.barkScale[l]/7518,2));f.windowingFunction="hanning",f.hanning=new Float32Array(c);for(var l=0;c>l;l++)f.hanning[l]=.5-.5*Math.cos(2*Math.PI*l/(c-1));f.hamming=new Float32Array(c);for(var l=0;c>l;l++)f.hamming[l]=.54-.46*Math.cos(2*Math.PI*(l/c-1));if(f.windowing=function(a,b){var c=new Float32Array(a.length);if("hanning"==b)for(var d=0;d<a.length;d++)c[d]=a[d]*f.hanning[d];else if("hamming"==b)for(var d=0;d<a.length;d++)c[d]=a[d]*f.hamming[d];else if("blackman"==b)for(var d=0;d<a.length;d++)c[d]=a[d]*f.blackman[d];return c},f.setSource=function(a){h=a,h.connect(window.spn)},k(g)&&a)return f.featureInfo={buffer:{type:"array"},rms:{type:"number"},energy:{type:"number"},zcr:{type:"number"},complexSpectrum:{type:"multipleArrays",arrayNames:{1:"real",2:"imag"}},amplitudeSpectrum:{type:"array"},powerSpectrum:{type:"array"},spectralCentroid:{type:"number"},spectralFlatness:{type:"number"},spectralSlope:{type:"number"},spectralRolloff:{type:"number"},spectralSpread:{type:"number"},spectralSkewness:{type:"number"},spectralKurtosis:{type:"number"},loudness:{type:"multipleArrays",arrayNames:{1:"total",2:"specific"}},perceptualSpread:{type:"number"},perceptualSharpness:{type:"number"},mfcc:{type:"array"}},f.featureExtractors={buffer:function(a,b){return b.signal},rms:function(a,b){for(var c=0,d=0;d<b.signal.length;d++)c+=Math.pow(b.signal[d],2);return c/=b.signal.length,c=Math.sqrt(c)},energy:function(a,b){for(var c=0,d=0;d<b.signal.length;d++)c+=Math.pow(Math.abs(b.signal[d]),2);return c},complexSpectrum:function(a,b){return b.complexSpectrum},spectralSlope:function(a,b){for(var c=0,d=0,e=new Float32Array(b.ampSpectrum.length),f=0,g=0,h=0;h<b.ampSpectrum.length;h++){c+=b.ampSpectrum[h];var i=h*b.audioContext.sampleRate/a;e[h]=i,f+=i*i,d+=i,g+=i*b.ampSpectrum[h]}return(b.ampSpectrum.length*g-d*c)/(c*(f-Math.pow(d,2)))},spectralCentroid:function(a,b){return j(1,b.ampSpectrum)},spectralRolloff:function(a,b){for(var c=b.ampSpectrum,d=b.audioContext.sampleRate/(2*(c.length-1)),e=0,f=0;f<c.length;f++)e+=c[f];for(var g=.99*e,h=c.length-1;e>g&&h>=0;)e-=c[h],--h;return(h+1)*d},spectralFlatness:function(a,b){for(var c=b.ampSpectrum,d=0,e=0,f=0;f<c.length;f++)d+=Math.log(c[f]),e+=c[f];return Math.exp(d/c.length)*c.length/e},spectralSpread:function(a,b){var c=b.ampSpectrum;return Math.sqrt(j(2,c)-Math.pow(j(1,c),2))},spectralSkewness:function(a,b){var c=b.ampSpectrum,d=j(1,c),e=j(2,c),f=j(3,c),g=2*Math.pow(d,3)-3*d*e+f,h=Math.pow(Math.sqrt(e-Math.pow(d,2)),3);return g/h},spectralKurtosis:function(a,b){var c=b.ampSpectrum,d=j(1,c),e=j(2,c),f=j(3,c),g=j(4,c),h=-3*Math.pow(d,4)+6*d*e-4*d*f+g,i=Math.pow(Math.sqrt(e-Math.pow(d,2)),4);return h/i},amplitudeSpectrum:function(a,b){return b.ampSpectrum},zcr:function(a,b){for(var c=0,d=0;d<b.signal.length;d++)(b.signal[d]>=0&&b.signal[d+1]<0||b.signal[d]<0&&b.signal[d+1]>=0)&&c++;return c},powerSpectrum:function(a,b){for(var c=new Float32Array(b.ampSpectrum.length),d=0;d<c.length;d++)c[d]=Math.pow(b.ampSpectrum[d],2);return c},loudness:function(a,b){var c=24,d=new Float32Array(c),e=0,g=b.ampSpectrum,h=new Int32Array(c+1);h[0]=0;for(var i=f.barkScale[b.ampSpectrum.length-1]/c,j=1,k=0;k<b.ampSpectrum.length;k++)for(;f.barkScale[k]>i;)h[j++]=k,i=j*f.barkScale[b.ampSpectrum.length-1]/c;h[c]=b.ampSpectrum.length-1;for(var k=0;c>k;k++){for(var l=0,m=h[k];m<h[k+1];m++)l+=g[m];d[k]=Math.pow(l,.23)}for(var k=0;k<d.length;k++)e+=d[k];return{specific:d,total:e}},perceptualSpread:function(a,b){for(var c=b.featureExtractors.loudness(a,b),d=0,e=0;e<c.specific.length;e++)c.specific[e]>d&&(d=c.specific[e]);var f=Math.pow((c.total-d)/c.total,2);return f},perceptualSharpness:function(a,b){for(var c=b.featureExtractors.loudness(a,b),d=c.specific,e=0,f=0;f<d.length;f++)e+=15>f?(f+1)*d[f+1]:.066*Math.exp(.171*(f+1));return e*=.11/c.total},mfcc:function(b,c){for(var d=c.featureExtractors.powerSpectrum(b,c),e=function(a){var b=1125*Math.log(1+a/700);return b},f=function(a){var b=700*(Math.exp(a/1125)-1);return b},g=26,h=new Float32Array(g+2),i=new Float32Array(g+2),j=0,k=a.sampleRate/2,l=e(j),m=e(k),n=m-l,o=n/(g+1),p=Array(g+2),q=0;q<h.length;q++)h[q]=q*o,i[q]=f(h[q]),p[q]=Math.floor((b+1)*i[q]/a.sampleRate);for(var r=Array(g),s=0;s<r.length;s++){r[s]=Array.apply(null,new Array(b/2+1)).map(Number.prototype.valueOf,0);for(var q=p[s];q<p[s+1];q++)r[s][q]=(q-p[s])/(p[s+1]-p[s]);for(var q=p[s+1];q<p[s+2];q++)r[s][q]=(p[s+2]-q)/(p[s+2]-p[s+1])}for(var t=new Float32Array(g),q=0;q<t.length;q++){t[q]=0;for(var s=0;b/2>s;s++)r[q][s]=r[q][s]*d[s],t[q]+=r[q][s];t[q]=Math.log(t[q])}for(var u=Math.PI/g,v=1/Math.sqrt(g),w=Math.sqrt(2/g),x=13,y=new Float32Array(x*g),q=0;x>q;q++)for(var s=0;g>s;s++){var z=q+s*x;y[z]=0==q?v*Math.cos(u*(q+1)*(s+.5)):w*Math.cos(u*(q+1)*(s+.5))}for(var A=new Float32Array(x),u=0;x>u;u++){for(var B=0,C=0;g>C;C++){var z=u+C*x;B+=y[z]*t[C]}A[u]=B/x}return A}},window.spn=a.createScriptProcessor(g,1,1),spn.connect(a.destination),window.spn.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0);f.signal=b;var c=f.windowing(f.signal,f.windowingFunction),h=new complex_array.ComplexArray(g);h.map(function(a,b){a.real=c[b]});var j=h.FFT();f.complexSpectrum=j,f.ampSpectrum=new Float32Array(g/2);for(var k=0;g/2>k;k++)f.ampSpectrum[k]=Math.sqrt(Math.pow(j.real[k],2)+Math.pow(j.imag[k],2));"function"==typeof d&&i&&d(f.get(e))},f.start=function(a){e=a,i=!0},f.stop=function(){i=!1},f.audioContext=a,f.get=function(a){if("object"==typeof a){for(var b={},c=0;c<a.length;c++)try{b[a[c]]=f.featureExtractors[a[c]](g,f)}catch(d){console.error(d)}return b}if("string"==typeof a)return f.featureExtractors[a](g,f);throw"Invalid Feature Format"},h.connect(window.spn,0,0),f;throw"undefined"==typeof a?"AudioContext wasn't specified: Meyda will not run.":"Buffer size is not a power of two: Meyda will not run."};!function(a,b){function c(a){return a.forEach||(a.forEach=function(a){var b,c=this.length;for(b=0;c>b;b++)a(this[b],b,c)}),a}var d,e,f=Float32Array,g=Math.sqrt,h=function(a){return Math.pow(a,2)};a.isComplexArray=d=function(a){return a!==b&&a.hasOwnProperty!==b&&a.hasOwnProperty("real")&&a.hasOwnProperty("imag")},a.ComplexArray=e=function(a,b){d(a)?(this.ArrayType=a.ArrayType,this.real=new this.ArrayType(a.real),this.imag=new this.ArrayType(a.imag)):(this.ArrayType=b||f,this.real=new this.ArrayType(a),this.imag=new this.ArrayType(this.real.length)),this.length=this.real.length},e.prototype.toString=function(){var a=[];return this.forEach(function(b){a.push("("+b.real.toFixed(2)+","+b.imag.toFixed(2)+")")}),"["+a.join(",")+"]"},e.prototype.map=function(a){var b,c=this.length,d={};for(b=0;c>b;b++)d.real=this.real[b],d.imag=this.imag[b],a(d,b,c),this.real[b]=d.real,this.imag[b]=d.imag;return this},e.prototype.forEach=function(a){var b,c=this.length,d={};for(b=0;c>b;b++)d.real=this.real[b],d.imag=this.imag[b],a(d,b,c)},e.prototype.conjugate=function(){return new e(this).map(function(a){a.imag*=-1})},e.prototype.magnitude=function(){var a=new this.ArrayType(this.length);return this.forEach(function(b,c){a[c]=g(h(b.real)+h(b.imag))}),c(a)}}("undefined"==typeof exports&&(this.complex_array={})||exports),!function(a,b){function c(a){return b.isComplexArray(a)&&a||new j(a)}function d(a,b){var c=a.length;return c&c-1?e(a,b):f(a,b)}function e(a,b){var c,e,f,g,h,l,p,q,r,s,t,u,v,w,x=a.length;if(1===x)return a;for(f=new j(x,a.ArrayType),q=i(x),r=x/q,s=1/m(q),t=new j(r,a.ArrayType),e=0;q>e;e++){for(c=0;r>c;c++)t.real[c]=a.real[c*q+e],t.imag[c]=a.imag[c*q+e];for(r>1&&(t=d(t,b)),l=n(2*k*e/x),p=(b?-1:1)*o(2*k*e/x),g=1,h=0,c=0;x>c;c++)v=t.real[c%r],w=t.imag[c%r],f.real[c]+=g*v-h*w,f.imag[c]+=g*w+h*v,u=g*l-h*p,h=g*p+h*l,g=u}for(c=0;x>c;c++)a.real[c]=s*f.real[c],a.imag[c]=s*f.imag[c];return a}function f(a,b){var c,d,e,f,g,i,j,m,p,q,r,s,t,u,v,w,x,y=a.length;for(e=h(a),f=e.real,g=e.imag,x=1;y>x;){for(m=n(k/x),p=(b?-1:1)*o(k/x),c=0;y/(2*x)>c;c++)for(i=1,j=0,d=0;x>d;d++)r=2*c*x+d,s=r+x,t=f[r],u=g[r],v=i*f[s]-j*g[s],w=j*f[s]+i*g[s],f[r]=l*(t+v),g[r]=l*(u+w),f[s]=l*(t-v),g[s]=l*(u-w),q=i*m-j*p,j=i*p+j*m,i=q;x<<=1}return e}function g(a,b){for(var c=0;b>1;)c<<=1,c+=1&a,a>>=1,b>>=1;return c}function h(a){var b,c,d=a.length,e={};for(c=0;d>c;c++){var f=g(c,d);e.hasOwnProperty(c)||e.hasOwnProperty(f)||(b=a.real[f],a.real[f]=a.real[c],a.real[c]=b,b=a.imag[f],a.imag[f]=a.imag[c],a.imag[c]=b,e[c]=e[f]=!0)}return a}function i(a){for(var b=3,c=m(a);c>=b;){if(a%b===0)return b;b+=2}return a}var j=b.ComplexArray,k=Math.PI,l=Math.SQRT1_2,m=Math.sqrt,n=Math.cos,o=Math.sin;j.prototype.FFT=function(){return d(this,!1)},a.FFT=function(a){return c(a).FFT()},j.prototype.InvFFT=function(){return d(this,!0)},a.InvFFT=function(a){return c(a).InvFFT()},j.prototype.frequencyMap=function(a){return this.FFT().map(a).InvFFT()},a.frequencyMap=function(a,b){return c(a).frequencyMap(b)}}("undefined"==typeof exports&&(this.fft={})||exports,"undefined"==typeof require&&this.complex_array||require("./complex_array"));